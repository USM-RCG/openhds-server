<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<body>
<ui:composition template="/templates/default.xhtml">
    <ui:define name="title">#{msg.uploadForm}</ui:define>
    <ui:define name="extraHeaders">
        <style>

            #tabs {
                list-style: none;
                height: 30px;
                border-bottom: solid 1px #CCC;
                padding: 0px;
                margin: 0px;
            }

            #tabs li {
                float: left;
                border-top: 1px solid #ccc;
                border-left: 1px solid #ccc;
                border-right: 1px solid #ccc;
                margin-right: 3px;
                border-top-left-radius: 3px;
                border-top-right-radius: 3px;
                outline: none;
            }

            #tabs li a {
                display:block;
                font-size: small;
                font-weight: bold;
                color: #4bbc77;
                padding: 7px;
                background: #FFF;
                border-bottom: 1px solid #fff;
                border-top-left-radius:3px;
                border-top-right-radius:3px;
                text-decoration:none;
                outline:none;
            }

            #tabs li a.inactive {
                padding: 7px;
                color:#666666;
                background: #EEE;
                outline:none;
                border-bottom: solid 1px #CCC;
            }

            #tabs li a:hover, #tabs li a.inactive:hover {
                color: #4bbc77;
                outline: none;
            }

            .tab-content {
                clear:both;
                display: none;
                width:100%;
                border-left: solid 1px #CCC;
                border-right: solid 1px #CCC;
                border-bottom: solid 1px #CCC;
                text-align:left;
                padding: 10px;
            }
        </style>
        <script src="#{request.contextPath}/resources/scripts/jquery-3.3.1.min.js" />
        <script>

            function upload($form, relUrl) {

                var data = new FormData($form[0]);
                var $button = $form.find(".uploadSubmit");

                $button.prop("disabled", true);

                $.ajax({
                    type: "POST",
                    enctype: 'multipart/form-data',
                    url: "#{request.contextPath}" + relUrl,
                    data: data,
                    processData: false, // don't make a query string out of the data
                    contentType: false,
                    cache: false,
                    timeout: 600000,
                    success: function () {
                        $("#result").text("#{msg.uploadSuccess}");
                        $form.trigger("reset");
                        $button.prop("disabled", false);
                    },
                    error: function (rsp) {
                        $("#result").addClass("error").text("#{msg.uploadFailed}: " + rsp.responseJSON.exception + ' - ' + rsp.responseJSON.message);
                        button.prop("disabled", false);
                    }
                });
            }

            $(document).ready(function () {

                // set first tab as active
                $('#tabs li a:not(:first)').addClass('inactive');
                $('.tab-content').hide();
                $('.tab-content:first').show();

                // install tab selection handlers
                $('#tabs li a').click(function() {
                    var tabId = $(this).attr('id');
                    if($(this).hasClass('inactive')) { //this is the start of our condition
                        $('#tabs li a').addClass('inactive');
                        $(this).removeClass('inactive');
                        $('.tab-content').hide();
                        $('#'+ tabId + '-content').fadeIn('slow');
                    }
                });

                // setup handlers to clear prior results
                $(".uploadSubmit").click(function(event) {
                    $("#result").removeClass("error").text("");
                });

                // setup handlers to submit each form
                $("#xmlform,#xmlxlsform").submit(function (event) {
                    event.preventDefault(); // prevent normal submit
                    upload($(this), '/uploadXmlForm');
                });

                $("#xlsform").submit(function (event) {
                    event.preventDefault(); // prevent normal submit
                    upload($(this), '/uploadXlsForm');
                });
            });
        </script>
    </ui:define>
    <ui:define name="display">
        <h1>#{msg.uploadForm}</h1>
        <div id="result" /><br/>
        <ul id="tabs">
            <li><a id="tab-xml">XML</a></li>
            <li><a id="tab-xmlxls">XML + XLSForm</a></li>
            <li><a id="tab-xls">XLSForm</a></li>
        </ul>
        <div id="tab-xml-content" class="tab-content">
            <form id="xmlform" class="uploadForm" enctype="multipart/form-data">
                <div>
                    <label for="xml_form_def_file">#{msg.xmlForm}:</label><br/>
                    <input id="xml_form_def_file" type="file" name="form_def_file" required="" accept="text/xml,application/xml"/><br/><br/>
                    <label for="xml_media_files">#{msg.mediaFiles}:</label><br/>
                    <input id="xml_media_files" type="file" name="media_files" multiple="" />
                </div>
                <br/>
                <input class="uploadSubmit" type="submit" value="#{msg.upload}"/>
            </form>
        </div>
        <div id="tab-xmlxls-content" class="tab-content">
            <form id="xmlxlsform" class="uploadForm" enctype="multipart/form-data">
                <div>
                    <label for="xmlxls_form_def_file">#{msg.xmlForm}:</label><br/>
                    <input id="xmlxls_form_def_file" type="file" name="form_def_file" required="" accept="text/xml,application/xml"/><br/><br/>
                    <label for="xmlxls_xlsform_def_file">#{msg.xlsform}:</label><br/>
                    <input id="xmlxls_xlsform_def_file" type="file" name="xlsform_def_file" required="" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/><br/><br/>
                    <label for="xmlxls_media_files">#{msg.mediaFiles}:</label><br/>
                    <input id="xmlxls_media_files" type="file" name="media_files" multiple="" />
                </div>
                <br/>
                <input class="uploadSubmit" type="submit" value="#{msg.upload}"/>
            </form>
        </div>
        <div id="tab-xls-content" class="tab-content">
            <form id="xlsform" class="uploadForm" enctype="multipart/form-data">
                <div>
                    <label for="xls_xlsform_def_file">#{msg.xlsform}:</label><br/>
                    <input id="xls_xlsform_def_file" type="file" name="xlsform_def_file" required="" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/><br/><br/>
                    <label for="xls_media_files">#{msg.mediaFiles}:</label><br/>
                    <input id="xls_media_files" type="file" name="media_files" multiple="" />
                </div>
                <br/>
                <input class="uploadSubmit" type="submit" value="#{msg.upload}"/>
            </form>
        </div>

    </ui:define>
</ui:composition>
</body>
</html>